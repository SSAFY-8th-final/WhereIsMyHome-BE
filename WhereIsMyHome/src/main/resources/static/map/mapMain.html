<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>동별 실거래가 조회</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
    <link rel="stylesheet" href="/css/style2.css" type="text/css"></link>
</head>
<body>

<div id="mySidepanel" class="sidepanel">
  <div class="row" id="deal-content">

	<div id="nav-menu-left">
    <button class="btn btn-sm btn-outline-secondary" id="homeBtn"><a href="/index.html">Home</a></button>
  </div>

        <div class="container"> 
            <div class="row">
                <h2 style="margin-left: 0.5em;">거래정보</h2>
                <hr>
            </div>
            <div id="deal-list" class="row deal-list">
                <div class="row deal-list-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  <div class="row deal-name">경희궁의아침 2단지</div>
                  <div class="row deal-money">거래금액: 105,000<br>면적: 124.17</div>
                  <div class="row deal-date">2015.12</div>
                </div>
                <div class="row deal-list-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  <div class="row deal-name">경희궁 파크팰리스</div>
                  <div class="row deal-money">거래금액: 120,000<br>면적: 146.33</div>
                  <div class="row deal-date">2015.12</div>
                </div>
                <div class="row deal-list-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  <div class="row deal-name">경희궁 파크팰리스</div>
                  <div class="row deal-money">거래금액: 120,000<br>면적: 146.33</div>
                  <div class="row deal-date">2015.12</div>
                </div>
                <div class="row deal-list-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  <div class="row deal-name">경희궁 파크팰리스</div>
                  <div class="row deal-money">거래금액: 120,000<br>면적: 146.33</div>
                  <div class="row deal-date">2015.12</div>
                </div>
                <div class="row deal-list-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  <div class="row deal-name">경희궁의아침 2단지</div>
                  <div class="row deal-money">거래금액: 105,000<br>면적: 124.17</div>
                  <div class="row deal-date">2015.12</div>
                </div>
                <div class="row deal-list-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                    <div class="row deal-name">경희궁의아침 2단지</div>
                    <div class="row deal-money">거래금액: 105,000<br>면적: 124.17</div>
                    <div class="row deal-date">2015.12</div>
                  </div>
                  <div class="row deal-list-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                    <div class="row deal-name">경희궁의아침 2단지</div>
                    <div class="row deal-money">거래금액: 105,000<br>면적: 124.17</div>
                    <div class="row deal-date">2015.12</div>
                  </div>
                  <div class="row deal-list-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                    <div class="row deal-name">경희궁의아침 2단지</div>
                    <div class="row deal-money">거래금액: 105,000<br>면적: 124.17</div>
                    <div class="row deal-date">2015.12</div>
                  </div>
              
              </div>

        </div>      

</div>
  
<div onclick="sidePannelControll()">
<svg id="localInfoTest" sidePannelControll() xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-right closebtn" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671z"/>
</svg> 
  </div>
   <!-- <div id="localInfoTest" class="closebtn" onclick="sidePannelControll()">00000000</div> -->
</div>

    <div class="contianer">
        <!-- 헤더 위치입니다 -->

        <!-- 거래정보 -->
        <div class="row" id="deal-content">  
            <div id="map-wrapper">
                <div id="map-detail">
                	<div id="localInfo">dd

                	<div class="row" id="deal-header"> 
                        <div class="col-2 mb-2"> 서울 > </div>
                        <div class="col-2 mb-2 me-4">
                        <select id="gugun-select" class="form-select form-select-sm" aria-label=".form-select-sm example">
                           ..
                        </select>
                        </div>
                        <div class="col-2 mb-2 me-4">
                         <select id="dong-select" class="form-select form-select-sm" aria-label=".form-select-sm example">
                         ...
                         </select>
                         </div>
                         <div class="col-2 mb-2 me-4">
                             <input id="search-input" class="form-control form-control-sm" type="search" placeholder="Search" aria-label="Search">
                         </div>
                          <div class="col-1 mb-2">
                              <button id="search-button" class="btn btn-outline-primary" type="button">Search</button>
                          </div>
                            </div>
                        </div>
                    
                    </div>
                </div>
            </div>
        </div>
            

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=30825d7ff55d14a818299c266e641081"></script>
<script src="/js/addressSelectBox.js"></script>
<script src="/js/sidePanel.js"></script>
<script>
let houseListArr = [];

window.onload = async function(){
	let gugun_select = document.querySelector("#gugun-select");
	await gugunList(11);
	
	dongList(Number(gugun_select.options[0].value));
	
	gugun_select.onchange = function(){
		let value = (gugun_select.options[gugun_select.selectedIndex].value);
		dongList(Number(value));

	}
	
	document.querySelector("#search-button").onclick = async function search(){
		
		if(validateSearch()){
			await houseList();
		} else{
			alert("검색 범위가 너무 넓습니다");
		}
	}
}
	// 검색 범위 제한
	function validateSearch(){
		let isGugunExist = false;
		let isDongExist = false;
		let isSearchInputExist = false;
		
		let gugunVal = document.querySelector("#gugun-select").value;
		let dongVal = document.querySelector("#dong-select").value;
		let searchVal = document.querySelector("#search-input").value;
		
		 if( gugunVal.length > 0 ){
			 isGugunExist = true;
	     }
		 if( dongVal.length > 0 ){
			 isDongExist = true;
	     }
		 if( searchVal.length > 0 ){
			 isSearchInputExist = true;
	     }
		 
		 if((isGugunExist && isDongExist) ||(isGugunExist && isSearchInputExist))
			 return true;
		 
		 return false;
	}

	// 거래내역 + 집
	async function houseList(){
		let url = '/maps/houses';
		
		let gugun_select = document.querySelector("#gugun-select");
		let gugunCode = (gugun_select.options[gugun_select.selectedIndex].value);
		
		let dong = document.querySelector("#dong-select").value;
		let searchWord = document.querySelector("#search-input").value;
		
		let urlParams = '?gugunCode=' + gugunCode + '&dong=' + dong + '&searchWord=' + searchWord;
		let fetchOptions = {
			method: 'GET',
		}
		
		try{
			let response = await fetch( url + urlParams, fetchOptions);
			let data = await response.json();
			houseListArr = null;
			houseListArr = data;
			console.log(houseListArr);
			//makeMapListHtml( data );
			
		}catch( error ){
			console.log(error);
			alert('거래내역 조회 과정에서 문제가 생겼습니다.')
		}
	}



/*------------------------지도--------------------------*/

var mapContainer = document.getElementById('map-detail'), // 지도를 표시할 div  
    mapOption = { 
        center: new kakao.maps.LatLng(37.574516, 126.968867), // 지도의 중심좌표
        level: 2 // 지도의 확대 레벨
    };

var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

//var geocoder = new kakao.maps.services.Geocoder();

// 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
var mapTypeControl = new kakao.maps.MapTypeControl();

// 지도에 컨트롤을 추가해야 지도위에 표시됩니다
// kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

// 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
var zoomControl = new kakao.maps.ZoomControl();
map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

 
//마커를 표시할 위치와 title 객체 배열입니다 
var positions = [
    {
        title: '광화문스페이스본(101동~105동)', 
        latlng: new kakao.maps.LatLng(37.574516, 126.968867)
    },
    {
        title: '광화문스페이스본(101동~105동)', 
        latlng: new kakao.maps.LatLng(37.5743, 126.968)
    },
    {
        title: '광화문스페이스본(101동~105동)', 
        latlng: new kakao.maps.LatLng(37.5742, 126.968)
    },
    {
        title: '광화문스페이스본(101동~105동)', 
        latlng: new kakao.maps.LatLng(37.5742, 126.9682)
    },
    {
        title: '광화문스페이스본(101동~105동)', 
        latlng: new kakao.maps.LatLng(37.5743, 126.9690)
    },

];

//마커 이미지의 이미지 주소입니다
var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; 
    
for (var i = 0; i < positions.length; i ++) {
    
    // 마커 이미지의 이미지 크기 입니다
    var imageSize = new kakao.maps.Size(24, 35); 
    
    // 마커 이미지를 생성합니다    
    var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 
    
    // 마커를 생성합니다
    var marker = new kakao.maps.Marker({
        map: map, // 마커를 표시할 지도
        position: positions[i].latlng, // 마커를 표시할 위치
        title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
        image : markerImage // 마커 이미지 
    });
}


</script>


</body>
</html>
